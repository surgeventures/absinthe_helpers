name: Elixir Dev Publish

env:
  DEBIAN_FRONTEND: noninteractive
  DEPENDENCY_FILE: mix.lock
  ELIXIR_VERSION: 1.16.2  # Elixir version used during package publishing
  JOB_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
  OTP_VERSION: 26.2.5  # OTP version used during package publishing
  RELEVANT_FILES: 'mix.lock mix.exs lib config test' # Important, this controls the caching, make sure to keep this right
  REPOSITORY: absinthe_helpers
  RUNNER_OS: ubuntu22 # Must match Elixir/OTP version in described in action erlef/setup-beam@v1
  SHA: ${{ github.sha }}

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch:
    inputs: {}

jobs:
  dev-publish:
    name: Dev Publish
    runs-on:
      - runs-on
      - runner=4cpu-linux-x64

    steps:
      - name: Publish Hex package
        uses: surgeventures/platform-tribe-actions/elixir/dev-publish@fast-elixir-repo-setup
        with:
          repository: ${{ env.REPOSITORY}}
          dependency-file: ${{ env.DEPENDENCY_FILE }}
          sha: ${{ env.SHA }}
          token: ${{ secrets.GITHUB_TOKEN }}
          hex-token: ${{ secrets.HEX_ORGANIZATION_WRITE_KEY }}
          mix-env: dev
          elixir-version: ${{ env.ELIXIR_VERSION }}
          otp-version: ${{ env.OTP_VERSION }}
          runner-os: ${{ env.RUNNER_OS }}
          relevant-files: ${{ env.RELEVANT_FILES}}
